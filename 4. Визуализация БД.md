# Глава 4. Визуализация БД.

## 4.1 Выгрузка данных для последующей визуализации.

5.1 Сохранение уникальных значений.
CREATE TABLE visual.vacancies_UQ LIKE diploma.vacancies;

ALTER TABLE visual.vacancies_UQ
MODIFY COLUMN identifier varchar(40) PRIMARY KEY;

INSERT IGNORE INTO visual.vacancies_UQ
SELECT * FROM diploma.vacancies ORDER BY date_last_updated;

5.2 Выгрузка по году для визуализации.
Сортируем по дате и году.

SELECT date_creation AS `Значения`, 
COUNT(date_creation) AS `Количество`
FROM curricula_vitae 
GROUP BY date_creation
ORDER BY year(date_creation);

-- создаем пустую копию таблицы
CREATE TABLE cur_vit_2020_21 LIKE curricula_vitae;

-- меняем столбец на primary key
ALTER TABLE cur_vit_2020_21
    MODIFY id_cv VARCHAR(40) PRIMARY KEY;

-- добавляем значения в таблицу, заменяя уникальный ключ, если надо
INSERT IGNORE cur_vit_2020_21 
SELECT * FROM curricula_vitae
WHERE YEAR(date_creation) = 2020 OR YEAR(date_creation) = 2021
ORDER BY date_last_updated;

-- добавляем значения в таблицу c primary key, заменяя уникальный ключ, если надо
REPLACE INTO curricula_vitae_2021_tmp SELECT * FROM curricula_vitae_2021
ORDER BY date_last_updated;

Сохранить из одной базы в другую часть таблицы:
-- из одной таблицы в другую по условию (responses_21 заполнила)
INSERT INTO visual.responses_21 
	SELECT * FROM diploma.responses 
		WHERE id_vacancy IN 
			(SELECT identifier FROM visual.vacancies_21);

Выгрузка айтишников за 20_21 год: 40_198 записей.
CREATE TABLE visual.it_20_21 LIKE diploma.vac_2020_21;

INSERT INTO visual.it_20_21 
SELECT * FROM diploma.vac_2020_21 
WHERE industry  = 'InformationTechnology';
	Пустые ячейки отрасли.
SELECT count(1) FROM vacancies_20_21 WHERE industry IS NULL; -- 8709

SELECT count(1) FROM vacancies_21 WHERE industry IS NULL; -- 7911

SELECT count(1) FROM diploma.vac_2020_21 
WHERE industry IS NULL AND YEAR(date_creation) = 2020; -- 798

	Количлелство ИТ вакансий за 20 и 21 год.
SELECT count(1) FROM it_20_21 WHERE year(date_creation) = 2020; -- 21509

SELECT count(1) FROM it_20_21 WHERE year(date_creation) = 2021; -- 18689

	Разных наименований Information Technologies в айтишниках за 20, 21 годы.
SELECT title FROM it_20_21 GROUP BY title; -- 3_591
	Количество резюме ИТ за 20, 21
SELECT count(1) FROM it_cv_20_21 WHERE year(date_creation) = 2020; -- 72197

SELECT count(1) FROM it_cv_20_21 WHERE year(date_creation) = 2021; -- 26386


-- из одной таблицы в другую по условию (responses_21 заполнила)
INSERT INTO visual.responses_21 
	SELECT * FROM diploma.responses 
		WHERE id_vacancy IN 
			(SELECT identifier FROM visual.vacancies_21);

CREATE TABLE cv_21_09_11 LIKE cv_21;

INSERT INTO cv_21_09_11 SELECT * FROM cv_21
		WHERE month(date_creation) = 09 
			OR month(date_creation) = 10
            OR month(date_creation) = 11;

Выгрузка: CREATE TABLE visual.vac2021_09_10 LIKE visual.vacancies_uq;
INSERT INTO visual.vac2021_09_10 SELECT * FROM visual.vac_2021
		WHERE MONTH(date_creation) = 09
        OR MONTH(date_creation) = 10; 
 Сначала индекс:
CREATE INDEX `id_vac` ON diploma.responses (id_vacancy);
CREATE INDEX `id_cv` ON diploma.responses (id_cv);

CREATE TABLE visual.resp_20_21 LIKE diploma.responses;
INSERT INTO visual.resp_20_21 SELECT * FROM diploma.responses
		WHERE id_vacancy IN 
			(SELECT identifier FROM visual.vac_2020)
            OR id_vacancy IN 
			(SELECT identifier FROM visual.vac_2021)
            OR id_cv IN 
			(SELECT id_cv FROM visual.cv_2020)
            OR id_cv IN 
			(SELECT id_cv FROM visual.cv_2021);


## 4.2 Работа с данными в MS Power BI посредством Direct Query.
